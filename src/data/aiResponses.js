const knowledgeBase = [
  {
    keywords: ['what is investing', 'define investing', 'investing mean', 'what does investing'],
    response: "**Investing** is the act of allocating money into assets â€” like stocks, bonds, real estate, or funds â€” with the expectation that they'll grow in value over time.\n\nUnlike saving (which preserves money in low-risk accounts), investing puts your money to work so it can:\n- **Outpace inflation** (which erodes purchasing power at ~3% per year)\n- **Compound over time** (earning returns on your returns)\n- **Build long-term wealth** for goals like retirement or financial freedom\n\nThe key principle: you accept some short-term risk in exchange for potentially higher long-term returns."
  },
  {
    keywords: ['how to start', 'begin investing', 'start investing', 'first investment', 'beginner invest'],
    response: "Here's a step-by-step plan to **start investing**:\n\n1. **Build an emergency fund first** â€” 3-6 months of expenses in a savings account\n2. **Pay off high-interest debt** â€” credit cards charging 15%+ should be paid first\n3. **Open a brokerage account** â€” platforms like Fidelity, Vanguard, or Schwab have no minimums\n4. **Start with index funds** â€” an S&P 500 fund (like VOO or VTI) gives you instant diversification\n5. **Invest consistently** â€” set up automatic monthly investments, even $50/month adds up\n6. **Don't try to time the market** â€” regular investing beats waiting for the 'perfect' moment\n\nTry our **Demo Trading** page to practice with virtual money before investing real money!"
  },
  {
    keywords: ['stock', 'stocks', 'what is a stock', 'stock market', 'share'],
    response: "A **stock** (or share) represents a piece of ownership in a company.\n\nWhen you buy Apple stock, you literally become a part-owner of Apple. Companies sell shares to raise capital for growth.\n\n**Key concepts:**\n- **Stock price** â€” driven by supply and demand, reflecting investor expectations\n- **Market cap** â€” total value of all shares (price Ã— number of shares)\n- **Dividend** â€” some companies share profits with shareholders quarterly\n- **P/E ratio** â€” price divided by earnings; shows how much investors pay per $1 of profit\n\n**Stock exchanges** like NYSE and NASDAQ are regulated marketplaces where stocks are bought and sold. Major indices like the **S&P 500** track the top 500 US companies."
  },
  {
    keywords: ['etf', 'index fund', 'index funds', 'what is etf', 'exchange traded'],
    response: "**ETFs (Exchange-Traded Funds)** and **index funds** are bundles of investments in a single package.\n\nInstead of buying 500 individual stocks, you buy one S&P 500 ETF to own a piece of all 500 companies.\n\n**Why they're popular:**\n- ğŸ“Š **Instant diversification** â€” one purchase, hundreds of stocks\n- ğŸ’° **Low fees** â€” typically 0.03-0.20% vs 1-2% for active funds\n- ğŸ† **They usually win** â€” ~90% of active managers underperform index funds over 15 years\n\n**Popular ETFs:**\n- **VTI** â€” Total US stock market\n- **VXUS** â€” International stocks\n- **BND** â€” US bonds\n- **VOO** â€” S&P 500\n\nWarren Buffett recommends a low-cost S&P 500 index fund for most investors."
  },
  {
    keywords: ['diversif', 'diversification', 'portfolio', 'allocation', 'asset allocation'],
    response: "**Diversification** means spreading investments across different assets, sectors, and regions to reduce risk.\n\n**The core idea:** if one investment drops 50%, but it's only 10% of your portfolio, your total loss is just 5%.\n\n**A well-diversified portfolio might include:**\n- ğŸ‡ºğŸ‡¸ US stocks (40-60%)\n- ğŸŒ International stocks (15-25%)\n- ğŸ“ˆ Bonds (15-30%)\n- ğŸ  Real estate/REITs (5-10%)\n\n**Age-based allocation rule:** \"110 minus your age = percentage in stocks\"\n- Age 25 â†’ 85% stocks, 15% bonds\n- Age 45 â†’ 65% stocks, 35% bonds\n- Age 65 â†’ 45% stocks, 55% bonds\n\nRebalance your portfolio every 6-12 months to maintain your target allocation."
  },
  {
    keywords: ['risk', 'risky', 'safe investment', 'risk tolerance', 'volatile', 'volatility'],
    response: "**Risk and return are directly linked** â€” higher potential returns require accepting higher risk.\n\n**Risk spectrum (low to high):**\n1. ğŸ¦ Savings accounts (~4% return, near-zero risk)\n2. ğŸ“œ Government bonds (4-5%, very low risk)\n3. ğŸ¢ Corporate bonds (5-7%, moderate risk)\n4. ğŸ“Š Stock index funds (8-10% historically, significant short-term volatility)\n5. ğŸš€ Individual growth stocks (potentially higher, but can lose 50%+)\n\n**Types of risk:**\n- **Market risk** â€” entire market declines\n- **Company risk** â€” individual business problems\n- **Inflation risk** â€” returns don't keep up with rising prices\n- **Concentration risk** â€” too much in one investment\n\n**Key principle:** your risk tolerance depends on your time horizon. If you won't need the money for 20+ years, you can afford more risk."
  },
  {
    keywords: ['dividend', 'dividends', 'passive income', 'dividend investing'],
    response: "**Dividends** are cash payments companies make to shareholders, usually quarterly, from their profits.\n\n**Key dividend terms:**\n- **Dividend yield** â€” annual dividend Ã· stock price (e.g., $4 dividend on $100 stock = 4% yield)\n- **Dividend aristocrats** â€” companies that increased dividends for 25+ consecutive years\n- **Payout ratio** â€” percentage of earnings paid as dividends (under 60% is generally sustainable)\n\n**Top dividend sectors:** Utilities, Consumer Staples, Healthcare, REITs\n\n**Example dividend stocks:**\n- Coca-Cola (KO) â€” ~3% yield, 60+ years of increases\n- Johnson & Johnson (JNJ) â€” ~3% yield, healthcare giant\n- Procter & Gamble (PG) â€” ~2.4% yield, consumer staples leader\n\n$25,000 invested at 3% average yield = **$750/year** in passive income, growing each year as dividends increase."
  },
  {
    keywords: ['compound', 'compound interest', 'compounding', 'time value'],
    response: "**Compound interest** is earning returns on your returns â€” it's the most powerful force in investing.\n\n**Example:** $10,000 invested at 8% annual return:\n- After 10 years: **$21,589** (you earned $11,589)\n- After 20 years: **$46,610** (you earned $36,610)\n- After 30 years: **$100,627** (you earned $90,627!)\n\nNotice how the growth accelerates â€” that's compounding in action. Most of the gains come in later years.\n\n**The key takeaway:** Starting early matters enormously.\n- Investing $200/month from age 25 to 65 at 8% = **$698,000**\n- Investing $200/month from age 35 to 65 at 8% = **$298,000**\n- Those extra 10 years more than doubled the result!\n\nAlbert Einstein reportedly called compound interest the \"eighth wonder of the world.\""
  },
  {
    keywords: ['crash', 'bear market', 'recession', 'market down', 'market crash', 'losing money'],
    response: "**Market crashes are a normal part of investing** â€” they happen roughly every 7-10 years.\n\n**Historical crashes and recoveries:**\n- 2008 Financial Crisis: S&P 500 fell 57%, recovered in ~4 years\n- 2020 COVID Crash: fell 34%, recovered in just 5 months\n- Dot-com Bust (2000): fell 49%, recovered in ~7 years\n\n**What to do during a crash:**\n1. âœ… **Don't panic sell** â€” selling locks in losses permanently\n2. âœ… **Keep investing** â€” buying during downturns means buying at discounts\n3. âœ… **Rebalance** â€” stocks dropped? Your allocation is now off-target\n4. âŒ **Don't try to time the bottom** â€” missing the 10 best days in a decade cuts returns in half\n\n**Warren Buffett's advice:** \"Be fearful when others are greedy, and greedy when others are fearful.\"\n\nTry our **Surviving a Market Crash** scenario in Demo Trading to practice!"
  },
  {
    keywords: ['crypto', 'bitcoin', 'cryptocurrency', 'blockchain'],
    response: "**Cryptocurrency** is a digital asset class that uses blockchain technology. Here's a balanced perspective:\n\n**Potential benefits:**\n- Decentralized â€” not controlled by any government\n- Limited supply (Bitcoin) could be inflation hedge\n- Growing institutional adoption\n\n**Significant risks:**\n- âš ï¸ Extremely volatile â€” Bitcoin has dropped 70%+ multiple times\n- âš ï¸ No intrinsic cash flow (unlike stocks that have earnings)\n- âš ï¸ Regulatory uncertainty\n- âš ï¸ Many scams in the crypto space\n\n**If you invest in crypto:**\n- Keep it to **5% or less** of your total portfolio\n- Only invest money you can afford to lose completely\n- Stick to established cryptocurrencies (Bitcoin, Ethereum)\n- Use reputable, regulated exchanges\n\nMost financial advisors recommend building a solid stock/bond portfolio before considering crypto."
  },
  {
    keywords: ['pe ratio', 'p/e', 'price to earnings', 'valuation', 'overvalued', 'undervalued'],
    response: "The **P/E (Price-to-Earnings) ratio** is one of the most important stock valuation metrics.\n\n**P/E = Stock Price Ã· Earnings Per Share**\n\nA P/E of 20 means investors pay $20 for every $1 of annual earnings.\n\n**General guidelines:**\n- P/E < 15: Potentially **undervalued** (but check why)\n- P/E 15-25: **Fair value** for most established companies\n- P/E > 30: **Growth premium** â€” investors expect high future growth\n- P/E > 50: Potentially **overvalued** unless growth justifies it\n\n**Important context:**\n- Compare P/E within the same sector (tech stocks have higher P/E than utilities)\n- Forward P/E (based on projected earnings) is often more useful\n- A low P/E isn't always good â€” it might signal declining business\n- A high P/E isn't always bad â€” NVDA's high P/E reflects explosive AI growth\n\nUse P/E alongside other metrics like revenue growth and profit margins for a complete picture."
  },
  {
    keywords: ['hello', 'hi', 'hey', 'good morning', 'good afternoon', 'good evening'],
    response: "Hello! ğŸ‘‹ I'm your **AI Investment Tutor**. I'm here to help you learn about investing!\n\nHere are some things you can ask me:\n- ğŸ“š \"What is investing?\" â€” learn the basics\n- ğŸ“ˆ \"How does the stock market work?\"\n- ğŸ’¼ \"How should I build my first portfolio?\"\n- ğŸ¦ \"What are ETFs and index funds?\"\n- âš–ï¸ \"How do I manage risk?\"\n- ğŸ’° \"Tell me about dividend investing\"\n- ğŸ“Š \"How do I read a P/E ratio?\"\n\nOr ask any investment question â€” I'll do my best to explain it clearly!"
  },
  {
    keywords: ['thank', 'thanks', 'helpful', 'great', 'awesome', 'good answer'],
    response: "You're welcome! ğŸ˜Š I'm glad I could help.\n\nKeep learning â€” every question you ask makes you a better investor. The fact that you're educating yourself puts you ahead of most people.\n\nSome next steps you might consider:\n- ğŸ“– Check out our **Learn** page for structured lessons\n- ğŸ® Try a **Demo Trading** scenario to practice with virtual money\n- ğŸ’¬ Ask me another question â€” no question is too basic!\n\nRemember: the best investment you can make is in your own financial education."
  }
];

const defaultResponse = "That's a great question! While I don't have a specific answer for that topic yet, here are some things I can help with:\n\n- **Investment basics** â€” stocks, bonds, ETFs, index funds\n- **Portfolio building** â€” diversification, asset allocation\n- **Risk management** â€” understanding and managing investment risk\n- **Market concepts** â€” P/E ratios, dividends, compound interest\n- **Strategy** â€” growth vs. value investing, dollar-cost averaging\n- **Psychology** â€” behavioral biases, emotional discipline\n\nTry rephrasing your question or ask about any of these topics! You can also explore our **Learn** page for structured lessons on all these topics.";

export function getAIResponse(userMessage) {
  const lowerMessage = userMessage.toLowerCase().trim();

  if (lowerMessage.length < 2) {
    return "Could you provide a bit more detail? I'm here to help with any investing questions!";
  }

  let bestMatch = null;
  let bestScore = 0;

  for (const entry of knowledgeBase) {
    let score = 0;
    for (const keyword of entry.keywords) {
      if (lowerMessage.includes(keyword)) {
        score += keyword.split(' ').length;
      }
    }
    if (score > bestScore) {
      bestScore = score;
      bestMatch = entry;
    }
  }

  if (bestMatch && bestScore > 0) {
    return bestMatch.response;
  }

  return defaultResponse;
}
